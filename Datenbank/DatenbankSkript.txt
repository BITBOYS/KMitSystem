DROP TABLE user_team;
DROP TABLE team_tournament;
DROP TABLE match;
DROP TABLE team;
DROP TABLE tournament;
DROP TABLE user;

CREATE TABLE user (
	username char(30) NOT NULL,
	password char(32) NOT NULL,
	email char(40) UNIQUE NOT NULL,
	goals INT,
	goals_conceded INT,
	wins INT,
	defeats INT,
	PRIMARY KEY (username)
);

CREATE TABLE tournament (
	name CHAR(30) NOT NULL,
	leader CHAR(30) NOT NULL,
	start_date DATETIME,
	end_date DATETIME,
	password CHAR(32),
	nr_of_matchdays INT,
	venue CHAR(30),
	term of application DATETIME
	PRIMARY KEY (name),
	FOREIGN KEY (leader) REFERENCES user(username) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE team (
	name CHAR(30) NOT NULL,
	tag CHAR(3) NOT NULL,
	leader CHAR(30) NOT NULL,
	passwort CHAR(32),
	goals INT,
	goals_conceded INT,
	wins INT,
	defeats INT,
	PRIMARY KEY (name),
	FOREIGN KEY (leader) REFERENCES user(username) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE match (
	tournament CHAR(30) NOT NULL,
	match_id INT NOT NULL,
	season_id INT NOT NULL,
	team_home CHAR(30),
	team_away CHAR(30),
	goals_home TINYINT,
	goals_away TINYINT,
	PRIMARY KEY (tournament, match_id),
	FOREIGN KEY (tournament) REFERENCES tournament(name) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (team_home) REFERENCES team(name) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (team_away) REFERENCES team(name) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE team_tournament (
	team CHAR(30) NOT NULL,
	tournament CHAR(30) NOT NULL,
	goals INT,
	goals_conceded INT,
	wins INT,
	defeats INT,
	PRIMARY KEY (team, tournament),
	FOREIGN KEY (team) REFERENCES team(name) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (tournament) REFERENCES tournament(name) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE user_team (
	user CHAR(30) NOT NULL,
	team CHAR(30) NOT NULL,
	enter_dat DATETIME NOT NULL,
	quit_dat DATETIME,
	PRIMARY KEY (user, team),
	FOREIGN KEY (user) REFERENCES user(username) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (team) REFERENCES team(name) ON DELETE CASCADE ON UPDATE CASCADE
);